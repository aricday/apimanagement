<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
    <l7:Policy xmlns:l7="http://ns.l7tech.com/2010/04/gateway-management" guid="5e684f4c-b26d-44f1-a323-c734e156eecf" id="af166f3fe1c8bff95a5fff928eacef84" version="1">
        <l7:PolicyDetail folderId="e7dbb9b46e8f153f8653b0b72105685c" guid="5e684f4c-b26d-44f1-a323-c734e156eecf" id="af166f3fe1c8bff95a5fff928eacef84" version="1">
            <l7:Name>OTK Authorization Server Configuration</l7:Name>
            <l7:PolicyType>Include</l7:PolicyType>
            <l7:Properties>
                <l7:Property key="revision">
                    <l7:LongValue>1</l7:LongValue>
                </l7:Property>
                <l7:Property key="soap">
                    <l7:BooleanValue>false</l7:BooleanValue>
                </l7:Property>
            </l7:Properties>
        </l7:PolicyDetail>
        <l7:Resources>
            <l7:ResourceSet tag="policy">
                <l7:Resource type="policy">
        &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
        &lt;wsp:Policy xmlns:L7p=&quot;http://www.layer7tech.com/ws/policy&quot; xmlns:wsp=&quot;http://schemas.xmlsoap.org/ws/2002/12/policy&quot;&gt;
            &lt;wsp:All wsp:Usage=&quot;Required&quot;&gt;
                &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue=&quot;Configure all variables required for the OAuth 2.0 authorization server&quot;/&gt;
                &lt;/L7p:CommentAssertion&gt;
                &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue=&quot;Used for redirecting to the next location&quot;/&gt;
                &lt;/L7p:CommentAssertion&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:AssertionComment assertionComment=&quot;included&quot;&gt;
                        &lt;L7p:Properties mapValue=&quot;included&quot;&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue=&quot;LEFT.COMMENT&quot;/&gt;
                                &lt;L7p:value stringValue=&quot;login_server&quot;/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue=&quot;RIGHT.COMMENT&quot;/&gt;
                                &lt;L7p:value stringValue=&quot;The server that is handling login requests during response_type requests, i.e.: https://myserver.com:port&quot;/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64Expression stringValue=&quot;aHR0cHM6Ly8ke2dhdGV3YXkuY2x1c3Rlci5ob3N0bmFtZX06ODQ0Mw==&quot;/&gt;
                    &lt;L7p:VariableToSet stringValue=&quot;host_login_server&quot;/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:AssertionComment assertionComment=&quot;included&quot;&gt;
                        &lt;L7p:Properties mapValue=&quot;included&quot;&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue=&quot;LEFT.COMMENT&quot;/&gt;
                                &lt;L7p:value stringValue=&quot;consent_server&quot;/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue=&quot;RIGHT.COMMENT&quot;/&gt;
                                &lt;L7p:value stringValue=&quot;The server that is handling consent requests during response_type requests, i.e.: https://myserver.com:port&quot;/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64Expression stringValue=&quot;aHR0cHM6Ly8ke2dhdGV3YXkuY2x1c3Rlci5ob3N0bmFtZX06ODQ0Mw==&quot;/&gt;
                    &lt;L7p:VariableToSet stringValue=&quot;host_consent_server&quot;/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:AssertionComment assertionComment=&quot;included&quot;&gt;
                        &lt;L7p:Properties mapValue=&quot;included&quot;&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue=&quot;LEFT.COMMENT&quot;/&gt;
                                &lt;L7p:value stringValue=&quot;login_path&quot;/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue=&quot;RIGHT.COMMENT&quot;/&gt;
                                &lt;L7p:value stringValue=&quot;Path of the URL that is receiving login requests&quot;/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64Expression stringValue=&quot;L2F1dGgvb2F1dGgvdjIvYXV0aG9yaXplL2xvZ2lu&quot;/&gt;
                    &lt;L7p:VariableToSet stringValue=&quot;path_login_server&quot;/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:AssertionComment assertionComment=&quot;included&quot;&gt;
                        &lt;L7p:Properties mapValue=&quot;included&quot;&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue=&quot;LEFT.COMMENT&quot;/&gt;
                                &lt;L7p:value stringValue=&quot;consent_path&quot;/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue=&quot;RIGHT.COMMENT&quot;/&gt;
                                &lt;L7p:value stringValue=&quot;Path of the URL that is receiving consent requests&quot;/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64Expression stringValue=&quot;L2F1dGgvb2F1dGgvdjIvYXV0aG9yaXplL2NvbnNlbnQ=&quot;/&gt;
                    &lt;L7p:VariableToSet stringValue=&quot;path_consent_server&quot;/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=&quot;JHtob3N0X2xvZ2luX3NlcnZlcn0ke3BhdGhfbG9naW5fc2VydmVyfQ==&quot;/&gt;
                    &lt;L7p:VariableToSet stringValue=&quot;location_login_server&quot;/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:Base64Expression stringValue=&quot;JHtob3N0X2NvbnNlbnRfc2VydmVyfSR7cGF0aF9jb25zZW50X3NlcnZlcn0=&quot;/&gt;
                    &lt;L7p:VariableToSet stringValue=&quot;location_consent_server&quot;/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue=&quot;Used at the default '/authorize/*' APIs.&quot;/&gt;
                &lt;/L7p:CommentAssertion&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:AssertionComment assertionComment=&quot;included&quot;&gt;
                        &lt;L7p:Properties mapValue=&quot;included&quot;&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue=&quot;LEFT.COMMENT&quot;/&gt;
                                &lt;L7p:value stringValue=&quot;session_lifetime&quot;/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue=&quot;RIGHT.COMMENT&quot;/&gt;
                                &lt;L7p:value stringValue=&quot;Used for internal session! During this period a request can be authorized&quot;/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64Expression stringValue=&quot;MzAw&quot;/&gt;
                    &lt;L7p:VariableToSet stringValue=&quot;sessionIdCacheAge&quot;/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue=&quot;Used at the default '/authorize*' API&quot;/&gt;
                &lt;/L7p:CommentAssertion&gt;
                &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue=&quot;Used to sign and encrypt a JWT identifying the current session&quot;/&gt;
                &lt;/L7p:CommentAssertion&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:AssertionComment assertionComment=&quot;included&quot;&gt;
                        &lt;L7p:Properties mapValue=&quot;included&quot;&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue=&quot;LEFT.COMMENT&quot;/&gt;
                                &lt;L7p:value stringValue=&quot;shared_secret&quot;/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue=&quot;RIGHT.COMMENT&quot;/&gt;
                                &lt;L7p:value stringValue=&quot;Used to sign the session data. 1 char == 8 bit&quot;/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64Expression stringValue=&quot;{{ otk_session_secret.stdout | b64encode }}&quot;/&gt;
                    &lt;L7p:VariableToSet stringValue=&quot;otk_session_secret&quot;/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:SetVariable&gt;
                    &lt;L7p:AssertionComment assertionComment=&quot;included&quot;&gt;
                        &lt;L7p:Properties mapValue=&quot;included&quot;&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue=&quot;LEFT.COMMENT&quot;/&gt;
                                &lt;L7p:value stringValue=&quot;shared_secret&quot;/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue=&quot;RIGHT.COMMENT&quot;/&gt;
                                &lt;L7p:value stringValue=&quot;Used to encrypt the session data. 1 char == 8 bit&quot;/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:Base64Expression stringValue=&quot;{{ otk_session_secret.stdout | b64encode }}&quot;/&gt;
                    &lt;L7p:VariableToSet stringValue=&quot;otk_session_secret_encryption&quot;/&gt;
                &lt;/L7p:SetVariable&gt;
                &lt;L7p:CommentAssertion&gt;
                    &lt;L7p:Comment stringValue=&quot;These two HTTP headers will always be added to a response of the authorization server&quot;/&gt;
                &lt;/L7p:CommentAssertion&gt;
                &lt;L7p:AddHeader&gt;
                    &lt;L7p:AssertionComment assertionComment=&quot;included&quot;&gt;
                        &lt;L7p:Properties mapValue=&quot;included&quot;&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue=&quot;LEFT.COMMENT&quot;/&gt;
                                &lt;L7p:value stringValue=&quot;HTTPS only&quot;/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue=&quot;RIGHT.COMMENT&quot;/&gt;
                                &lt;L7p:value stringValue=&quot;Inform the browser to only accept SSL connections&quot;/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:HeaderName stringValue=&quot;Strict-Transport-Security&quot;/&gt;
                    &lt;L7p:HeaderValue stringValue=&quot;max-age=31536000; includeSubDomains&quot;/&gt;
                    &lt;L7p:RemoveExisting booleanValue=&quot;true&quot;/&gt;
                    &lt;L7p:Target target=&quot;RESPONSE&quot;/&gt;
                &lt;/L7p:AddHeader&gt;
                &lt;L7p:AddHeader&gt;
                    &lt;L7p:AssertionComment assertionComment=&quot;included&quot;&gt;
                        &lt;L7p:Properties mapValue=&quot;included&quot;&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue=&quot;LEFT.COMMENT&quot;/&gt;
                                &lt;L7p:value stringValue=&quot;ClickJacking&quot;/&gt;
                            &lt;/L7p:entry&gt;
                            &lt;L7p:entry&gt;
                                &lt;L7p:key stringValue=&quot;RIGHT.COMMENT&quot;/&gt;
                                &lt;L7p:value stringValue=&quot;Do not allow overlapping of frames&quot;/&gt;
                            &lt;/L7p:entry&gt;
                        &lt;/L7p:Properties&gt;
                    &lt;/L7p:AssertionComment&gt;
                    &lt;L7p:HeaderName stringValue=&quot;X-Frame-Options&quot;/&gt;
                    &lt;L7p:HeaderValue stringValue=&quot;Deny&quot;/&gt;
                    &lt;L7p:RemoveExisting booleanValue=&quot;true&quot;/&gt;
                    &lt;L7p:Target target=&quot;RESPONSE&quot;/&gt;
                &lt;/L7p:AddHeader&gt;
            &lt;/wsp:All&gt;
        &lt;/wsp:Policy&gt;
        </l7:Resource>
            </l7:ResourceSet>
        </l7:Resources>
    </l7:Policy>
